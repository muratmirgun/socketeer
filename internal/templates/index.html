<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>wsdoc - WebSocket API Docs</title>
  <style>
    :root {
      --color-bg: #f8fafc;
      --color-fg: #1e293b;
      --color-card: #fff;
      --color-border: #e5e7eb;
      --color-primary: #2563eb;
      --color-secondary: #64748b;
      --color-accent: #16a34a;
      --color-error: #f87171;
      --color-muted: #e0e7ef;
      --color-header: #f1f5f9;
    }
    [data-theme="dark"] {
      --color-bg: #181a20;
      --color-fg: #f3f4f6;
      --color-card: #23272e;
      --color-border: #2d323c;
      --color-primary: #60a5fa;
      --color-secondary: #a1a1aa;
      --color-accent: #22d3ee;
      --color-error: #f87171;
      --color-muted: #23272e;
      --color-header: #23272e;
    }
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background: var(--color-bg); color: var(--color-fg); }
    .container { max-width: 900px; margin: 2rem auto; background: var(--color-card); border-radius: 10px; box-shadow: 0 2px 12px #0002; padding: 2rem; }
    .api-info-header { box-shadow: 0 2px 8px #0001; border-radius: 8px; background: var(--color-header); padding: 1.2em 1.5em; margin-bottom: 2.2rem; display:flex;align-items:center;gap:1.5em; }
    .api-info-header h1 { color: var(--color-primary); margin-bottom: 0.2em; font-size: 2.1em; }
    .theme-switcher { margin-left:auto; cursor:pointer; background:var(--color-muted); border:none; border-radius:50%; width:40px; height:40px; display:flex;align-items:center;justify-content:center; transition:background 0.2s; }
    .theme-switcher:hover { background:var(--color-border); }
    /* API Info Header */
    .api-info-header { box-shadow: 0 2px 8px #0001; border-radius: 8px; background: #f1f5f9; padding: 1.2em 1.5em; margin-bottom: 2.2rem; }
    .api-info-header h1 { color: #2563eb; margin-bottom: 0.2em; font-size: 2.1em; }
    /* Group Card */
    .group { margin-bottom: 2.2rem; border-radius: 10px; box-shadow: 0 2px 8px #0001; background: #f8fafc; transition: box-shadow 0.2s; }
    .group-header { cursor: pointer; font-size: 1.15em; font-weight: bold; background: #e0e7ef; padding: 0.7em 1.2em; border-radius: 10px 10px 0 0; margin-bottom: 0.2em; display: flex; align-items: center; gap: 0.7em; transition: background 0.2s; }
    .group-header:hover { background: #dbeafe; }
    .group-content { padding: 0.5em 1.2em 1.2em 1.2em; animation: fadeIn 0.3s; }
    /* Endpoint Card */
    .socket { margin-bottom: 2.5rem; border-radius: 8px; box-shadow: 0 1px 6px #0001; background: #fff; transition: box-shadow 0.2s; border: 1px solid #e5e7eb; }
    .socket-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem; cursor: pointer; padding: 0.7em 1.2em; border-radius: 8px 8px 0 0; background: #f1f5f9; transition: background 0.2s; }
    .socket-header:hover { background: #e0e7ef; }
    .socket-title { font-size: 1.3rem; font-weight: 600; color: #1e293b; display: flex; align-items: center; gap: 0.5em; }
    .socket-url { font-size: 0.95rem; color: #64748b; }
    .socket-tags { margin: 0.5rem 0; color: #64748b; font-size: 0.95em; }
    .socket-params { margin: 0.5rem 0; font-size: 0.97em; }
    /* Message Section */
    .msg-section { margin-top: 1.2rem; }
    .msg-header { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: #f1f5f9; border-radius: 4px; padding: 0.4rem 0.8rem; margin-bottom: 0.2rem; font-size: 1.08em; transition: background 0.2s; }
    .msg-header:hover { background: #e0e7ef; }
    .msg-list { margin: 0.5rem 0 0.5rem 0.5rem; transition: max-height 0.3s; }
    .msg { background: #f8fafc; border-left: 4px solid #2563eb; border-radius: 4px; padding: 0.7rem 1rem; margin: 0.5rem 0; box-shadow: 0 1px 3px #0001; display: flex; flex-direction: column; gap: 0.2em; }
    .msg .dir { font-weight: bold; padding: 0.1em 0.5em; border-radius: 4px; color: #fff; background: #2563eb; font-size: 0.98em; margin-right: 0.5em; }
    .msg .dir.receive { background: #16a34a; }
    .msg .deprecated { color: #f87171; font-weight: bold; margin-left: 0.7em; }
    .msg .msg-icon { font-size: 1.1em; margin-right: 0.3em; }
    pre { background: #e0e7ef; padding: 0.5rem; border-radius: 4px; overflow-x: auto; }
    /* Playground Tabs */
    .tab-btn { background: #e0e7ef; color: #2563eb; border: none; padding: 0.3em 1em; border-radius: 4px 4px 0 0; font-size: 1em; cursor: pointer; margin-right: 0.2em; transition: background 0.2s, color 0.2s; }
    .tab-btn.active, .tab-btn:focus { background: #2563eb; color: #fff; }
    /* Playground */
    .playground { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 1rem; margin-top: 1.5rem; box-shadow: 0 1px 4px #0001; }
    .playground label { font-weight: bold; }
    .playground input, .playground select, .playground textarea { font-family: monospace; margin: 0.2rem 0; padding: 0.2rem; border-radius: 3px; border: 1px solid #cbd5e1; }
    .playground button { background: #94a3b8; color: #fff; border: none; border-radius: 3px; padding: 0.3rem 1rem; margin-top: 0.5rem; cursor: pointer; }
    .playground button.active { background: #2563eb; }
    .playground button:disabled { background: #94a3b8; }
    .playground .log { background: #e0e7ef; border-radius: 4px; padding: 0.5rem; margin-top: 0.5rem; max-height: 120px; overflow-y: auto; font-size: 0.95em; }
    .playground .log-entry { margin-bottom: 0.2em; }
    .playground .log-entry .timestamp { color: #64748b; font-size: 0.92em; margin-right: 0.5em; }
    .collapser { font-size: 1.1em; color: #2563eb; margin-right: 0.5em; user-select: none; transition: transform 0.2s; }
    .collapser.open { transform: rotate(90deg); }
    .error { color: #f87171; font-weight: bold; }
    .status-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 0.5em; vertical-align: middle; }
    .status-disconnected { background: #f87171; }
    .status-connecting { background: #fbbf24; }
    .status-connected { background: #16a34a; }
    /* Responsive */
    @media (max-width: 700px) {
      .container { padding: 0.5rem; }
      .api-info-header { padding: 0.7em 0.5em; }
      .group-content, .socket-header, .socket-content, .playground { padding: 0.7em 0.5em; }
      .socket-title { font-size: 1.05rem; }
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
  <div class="container">
    <div id="api-info" class="api-info-header" style="margin-bottom:2.2rem;display:flex;align-items:center;gap:1.5em;">
      <img src="logo.png" alt="Socketeer Logo" style="height:48px;width:48px;vertical-align:middle;" />
      <div>
        <h1 style="margin:0;color:var(--color-primary);font-size:2.1em;line-height:1.1;display:inline-block;vertical-align:middle;">Socketeer <span style="font-size:1rem;color:var(--color-secondary)">WebSocket API Docs</span></h1>
      </div>
      <button id="theme-switcher" class="theme-switcher" title="Toggle dark mode">
        <span id="theme-icon">🌙</span>
      </button>
    </div>
    <div id="api"></div>
  </div>
  <script>
    // Tema yönetimi
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('socketeer-theme', theme);
      document.getElementById('theme-icon').textContent = theme === 'dark' ? '☀️' : '🌙';
    }
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme') || 'light';
      setTheme(current === 'dark' ? 'light' : 'dark');
    }
    document.getElementById('theme-switcher').onclick = toggleTheme;
    // İlk yüklemede tema tercihini uygula
    (function(){
      const saved = localStorage.getItem('socketeer-theme');
      if(saved) setTheme(saved);
    })();
    fetch('/wsapi.yaml')
      .then(r => r.text())
      .then(txt => jsyaml.load(txt))
      .then(spec => {
        // Render API info header
        const info = spec.info || {};
        const apiInfoEl = document.getElementById('api-info');
        apiInfoEl.innerHTML = `
          <div style="display:flex;align-items:center;gap:1.2em;flex-wrap:wrap;">
            <div style="flex:1 1 300px;">
              <h1 style="margin:0;color:var(--color-primary);font-size:2.1em;line-height:1.1;">${info.title || 'WebSocket API Docs'}</h1>
              <div style="color:var(--color-secondary);font-size:1.1em;margin:0.2em 0 0.7em 0;">${info.description || ''}</div>
              <div style="color:var(--color-secondary);font-size:0.98em;">
                <b>Version:</b> <span>${info.version || ''}</span>
                ${info.contact && (info.contact.name || info.contact.email) ? `<span style='margin-left:1.2em;'><b>Contact:</b> ${info.contact.name || ''}${info.contact.email ? ' &lt;' + info.contact.email + '&gt;' : ''}</span>` : ''}
                ${info.license && (info.license.name || info.license.url) ? `<span style='margin-left:1.2em;'><b>License:</b> ${info.license.url ? `<a href='${info.license.url}' target='_blank' style='color:var(--color-primary);text-decoration:underline;'>${info.license.name || info.license.url}</a>` : info.license.name}</span>` : ''}
              </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:0.5em;align-items:flex-end;">
              <button id="copy-yaml" style="background:var(--color-primary);color:#fff;border:none;padding:0.4em 1.2em;border-radius:5px;cursor:pointer;font-size:1em;">Copy YAML</button>
              <button id="download-yaml" style="background:var(--color-secondary);color:#fff;border:none;padding:0.4em 1.2em;border-radius:5px;cursor:pointer;font-size:1em;">Download YAML</button>
            </div>
          </div>
        `;
        // Copy/download YAML logic
        document.getElementById('copy-yaml').onclick = () => {
          fetch('/wsapi.yaml').then(r => r.text()).then(txt => {
            navigator.clipboard.writeText(txt);
            document.getElementById('copy-yaml').textContent = 'Copied!';
            setTimeout(()=>document.getElementById('copy-yaml').textContent='Copy YAML', 1200);
          });
        };
        document.getElementById('download-yaml').onclick = () => {
          fetch('/wsapi.yaml').then(r => r.text()).then(txt => {
            const blob = new Blob([txt], {type:'text/yaml'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'wsapi.yaml';
            a.click();
          });
        };
        const el = document.getElementById('api');
        if (!spec.sockets || !spec.sockets.length) {
          el.innerHTML = '<em>No WebSocket endpoints found.</em>';
          return;
        }
        // Group sockets by group (not tag)
        const groupMap = {};
        spec.sockets.forEach((socket, idx) => {
          const group = socket.group && socket.group.trim() ? socket.group : 'Ungrouped';
          if (!groupMap[group]) groupMap[group] = [];
          groupMap[group].push({socket, idx});
        });
        // Render groups
        el.innerHTML = Object.keys(groupMap).sort().map((group, gIdx) => `
          <div class="group" id="group-${gIdx}">
            <div class="group-header" onclick="toggleGroup(${gIdx})">
              <span class="collapser" id="group-collapser-${gIdx}">►</span> <span style="font-size:1.2em;">${group}</span>
            </div>
            <div class="group-content" id="group-content-${gIdx}" style="display:none;">
              ${groupMap[group].map(({socket, idx}, sIdx) => `
                <div class="socket" id="socket-${gIdx}-${sIdx}">
                  <div class="socket-header" onclick="toggleSocket(${gIdx},${sIdx})">
                    <span class="collapser" id="socket-collapser-${gIdx}-${sIdx}">►</span>
                    <span class="socket-title">
                      <span class="msg-icon">${socket.name.toLowerCase().includes('chat') ? '💬' : socket.name.toLowerCase().includes('notify') ? '🔔' : socket.name.toLowerCase().includes('ping') ? '🏓' : '🔗'}</span>
                      ${socket.name}
                    </span>
                    <span class="socket-url">${socket.url}</span>
                  </div>
                  <div class="socket-content" id="socket-content-${gIdx}-${sIdx}" style="display:none;">
                    <div style="margin-bottom:0.5em;">${socket.description || ''}</div>
                    <div class="socket-tags"><b>Tags:</b> ${(socket.tags||[]).join(', ')}</div>
                    <div class="socket-params"><b>Connection Params:</b> ${(socket.connectionParams||[]).map(p => `${p.name} <i>(${p.in}, ${p.type}${p.required ? ', required' : ''})</i>`).join(', ')}</div>
                    <div class="msg-section">
                      <div class="msg-header" onclick="toggleMsgList(${idx})">
                        <span class="collapser" id="collapser-${idx}">▼</span>
                        <b>Messages</b>
                      </div>
                      <div class="msg-list" id="msg-list-${idx}">
                        ${(socket.messages||[]).map((msg, mIdx) => `
                          <div class="msg">
                            <span class="dir${msg.direction==='receive' ? ' receive' : ''}">[${msg.direction}]</span> <b>${msg.type}</b> <span style="color:var(--color-secondary)">${msg.description||''}</span>
                            ${msg.deprecated ? `<span class='deprecated'>(Deprecated)</span>` : ''}
                            <div><b>Payload:</b> <pre>${JSON.stringify(msg.payload, null, 2)}</pre></div>
                            ${msg.example ? `<div><b>Example:</b> <pre>${JSON.stringify(msg.example, null, 2)}</pre></div>` : ''}
                            ${(msg.errors||[]).length ? `<div class='error'><b>Errors:</b> ${(msg.errors||[]).map(e => `${e.code}: ${e.description}`).join(', ')}</div>` : ''}
                          </div>
                        `).join('')}
                      </div>
                    </div>
                    <div class="playground" id="playground-${idx}">
                      <label style="font-size:1.1em;">Playground</label><br>
                      <div style="margin-bottom:0.5rem;">
                        <span style="font-size:0.95em;">Connect and test this WebSocket endpoint.</span>
                      </div>
                      <div style="margin-bottom:0.7rem;">
                        <button type="button" id="tab-example-${idx}" class="tab-btn active">Example</button>
                        <button type="button" id="tab-test-${idx}" class="tab-btn">Test</button>
                      </div>
                      <div id="example-pane-${idx}" style="display:block;">
                        <div style="background:var(--color-card);color:var(--color-fg);padding:1em;border-radius:6px;font-size:1.1em;overflow-x:auto;">
                          <pre id="example-json-${idx}" style="margin:0;background:transparent;color:inherit;font-size:1.1em;"></pre>
                        </div>
                      </div>
                      <div id="test-pane-${idx}" style="display:none;">
                        <button type="button" id="add-client-${idx}" style="background:var(--color-accent);color:#fff;margin-bottom:0.7em;">+ Yeni Client Ekle</button>
                        <div id="clients-container-${idx}"></div>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `).join('');

        // Collapse/expand logic for groups and sockets
        window.toggleGroup = function(gIdx) {
          const content = document.getElementById('group-content-' + gIdx);
          const collapser = document.getElementById('group-collapser-' + gIdx);
          if (content.style.display === 'none') {
            content.style.display = '';
            collapser.textContent = '▼';
            collapser.classList.add('open');
          } else {
            content.style.display = 'none';
            collapser.textContent = '►';
            collapser.classList.remove('open');
          }
        };
        window.toggleSocket = function(gIdx, sIdx) {
          const content = document.getElementById('socket-content-' + gIdx + '-' + sIdx);
          const collapser = document.getElementById('socket-collapser-' + gIdx + '-' + sIdx);
          if (content.style.display === 'none') {
            content.style.display = '';
            collapser.textContent = '▼';
            collapser.classList.add('open');
          } else {
            content.style.display = 'none';
            collapser.textContent = '►';
            collapser.classList.remove('open');
          }
        };

        // Collapsible message lists
        window.toggleMsgList = function(idx) {
          const el = document.getElementById('msg-list-' + idx);
          const collapser = document.getElementById('collapser-' + idx);
          if (el.style.display === 'none') {
            el.style.display = '';
            collapser.textContent = '▼';
            collapser.classList.add('open');
          } else {
            el.style.display = 'none';
            collapser.textContent = '►';
            collapser.classList.remove('open');
          }
        };

        // Helper to build ws://host:port/path from path or full URL
        function getWsUrl(pathOrUrl) {
          // If already absolute ws:// or wss://, use as is
          if (/^wss?:\/\//.test(pathOrUrl)) return pathOrUrl;
          const proto = window.location.protocol === 'https:' ? 'wss' : 'ws';
          return `${proto}://${window.location.host}${pathOrUrl.startsWith('/') ? pathOrUrl : '/' + pathOrUrl}`;
        }

        // Playground logic for each socket
        spec.sockets.forEach((socket, idx) => {
          // Multi-client state
          const clients = [];
          let clientCount = 0;
          const clientsContainer = document.getElementById(`clients-container-${idx}`);
          document.getElementById(`add-client-${idx}`).onclick = () => {
            addClientPanel();
          };
          function addClientPanel() {
            const clientId = clientCount++;
            const panel = document.createElement('div');
            panel.className = 'client-panel';
            panel.style = 'border:1px solid var(--color-border);border-radius:6px;padding:1em;margin-bottom:1em;background:var(--color-card);box-shadow:0 1px 4px #0001;';
            panel.innerHTML = `
              <div style="display:flex;align-items:center;gap:1em;margin-bottom:0.5em;">
                <b>Client #${clientId+1}</b>
                <span id="status-${idx}-${clientId}"><span class="status-dot status-disconnected"></span>Disconnected</span>
                <button id="remove-client-${idx}-${clientId}" style="margin-left:auto;background:var(--color-error);">Kaldır</button>
              </div>
              <div style="display:flex;gap:0.5em;margin-bottom:0.5em;">
                <button id="rec-toggle-${idx}-${clientId}" style="background:var(--color-primary);color:#fff;">Kaydı Başlat</button>
                <button id="rec-download-${idx}-${clientId}" style="background:var(--color-secondary);color:#fff;">İndir</button>
              </div>
              <form id="connform-${idx}-${clientId}" style="margin-bottom:0.5rem;display:flex;flex-wrap:wrap;gap:0.7em;align-items:center;">
                ${(socket.connectionParams||[]).map(p => `
                  <label>${p.name} (${p.in}):</label>
                  <input type="text" id="param-${idx}-${clientId}-${p.name}" placeholder="${p.description||''}" ${p.required?'required':''} style="margin-right:0.5em;" />
                `).join('')}
              </form>
              <div style="margin-bottom:0.5em;">
                <label>Message Type: </label>
                <select id="msgtype-${idx}-${clientId}">
                  ${(socket.messages||[]).filter(m=>m.direction==="send").map(m=>`<option value="${m.type}">${m.type}</option>`).join('')}
                </select>
              </div>
              <div style="margin-bottom:0.5em;">
                <label>Payload:</label><br>
                <textarea id="payload-${idx}-${clientId}" rows="4" cols="50">{}</textarea>
                <button type="button" id="copy-payload-${idx}-${clientId}" style="margin-left:0.5em;">Copy</button>
                <button type="button" id="clear-payload-${idx}-${clientId}" style="margin-left:0.2em;">Clear</button>
              </div>
              <button id="connect-${idx}-${clientId}">Connect</button>
              <button id="send-${idx}-${clientId}" disabled>Send</button>
              <button id="close-${idx}-${clientId}" disabled>Close</button>
              <button type="button" id="clear-log-${idx}-${clientId}" style="float:right;">Clear Log</button>
              <div class="log" id="log-${idx}-${clientId}"></div>
            `;
            clientsContainer.appendChild(panel);
            // Client state
            let ws = null;
            let connected = false;
            const log = panel.querySelector(`#log-${idx}-${clientId}`);
            const connectBtn = panel.querySelector(`#connect-${idx}-${clientId}`);
            const sendBtn = panel.querySelector(`#send-${idx}-${clientId}`);
            const closeBtn = panel.querySelector(`#close-${idx}-${clientId}`);
            const payloadInput = panel.querySelector(`#payload-${idx}-${clientId}`);
            const msgTypeSelect = panel.querySelector(`#msgtype-${idx}-${clientId}`);
            const statusEl = panel.querySelector(`#status-${idx}-${clientId}`);
            // Trafik kaydı
            let recording = false;
            let trafficLog = [];
            const recBtn = panel.querySelector(`#rec-toggle-${idx}-${clientId}`);
            const downloadBtn = panel.querySelector(`#rec-download-${idx}-${clientId}`);
            recBtn.onclick = () => {
              recording = !recording;
              recBtn.textContent = recording ? 'Kaydı Durdur' : 'Kaydı Başlat';
              if (!recording) {
                recBtn.style.background = 'var(--color-primary)';
              } else {
                recBtn.style.background = 'var(--color-accent)';
              }
            };
            downloadBtn.onclick = () => {
              if (!trafficLog.length) return;
              const blob = new Blob([JSON.stringify(trafficLog, null, 2)], {type:'application/json'});
              const a = document.createElement('a');
              a.href = URL.createObjectURL(blob);
              a.download = `ws-traffic-client${clientId+1}.json`;
              a.click();
            };
            // Connect
            connectBtn.onclick = (e) => {
              e.preventDefault();
              if (connected) return;
              let url = socket.url;
              (socket.connectionParams||[]).forEach(p => {
                const val = panel.querySelector(`#param-${idx}-${clientId}-${p.name}`).value;
                if (p.in === 'query') {
                  url += (url.includes('?') ? '&' : '?') + `${p.name}=${encodeURIComponent(val)}`;
                }
              });
              ws = new WebSocket(getWsUrl(url));
              statusEl.innerHTML = '<span class="status-dot status-connecting"></span>Connecting...';
              ws.onopen = () => {
                connected = true;
                statusEl.innerHTML = '<span class="status-dot status-connected"></span>Connected';
                connectBtn.disabled = true;
                sendBtn.disabled = false;
                closeBtn.disabled = false;
                logMsg('Connected', 'info');
              };
              ws.onmessage = (ev) => {
                logMsg(ev.data, 'in');
              };
              ws.onclose = () => {
                connected = false;
                statusEl.innerHTML = '<span class="status-dot status-disconnected"></span>Disconnected';
                connectBtn.disabled = false;
                sendBtn.disabled = true;
                closeBtn.disabled = true;
                logMsg('Disconnected', 'info');
              };
              ws.onerror = (err) => {
                logMsg('Error: ' + err.message, 'error');
              };
            };
            // Send
            sendBtn.onclick = (e) => {
              e.preventDefault();
              if (!connected) return;
              const msgType = msgTypeSelect.value;
              let payload = payloadInput.value;
              try { payload = JSON.stringify(JSON.parse(payload)); } catch {}
              ws.send(payload);
              logMsg(payload, 'out');
            };
            // Close
            closeBtn.onclick = (e) => {
              e.preventDefault();
              if (ws) ws.close();
            };
            // Copy/Clear payload
            panel.querySelector(`#copy-payload-${idx}-${clientId}`).onclick = () => {
              navigator.clipboard.writeText(payloadInput.value);
            };
            panel.querySelector(`#clear-payload-${idx}-${clientId}`).onclick = () => {
              payloadInput.value = '{}';
            };
            // Clear log
            panel.querySelector(`#clear-log-${idx}-${clientId}`).onclick = () => {
              log.innerHTML = '';
            };
            // Remove client
            panel.querySelector(`#remove-client-${idx}-${clientId}`).onclick = () => {
              if (ws) ws.close();
              panel.remove();
            };
            // Log helper
            function logMsg(msg, dir) {
              const entry = document.createElement('div');
              entry.className = 'log-entry';
              const ts = new Date().toLocaleTimeString();
              entry.innerHTML = `<span class='timestamp'>[${ts}]</span> <span style='color:${dir==='in'?'var(--color-accent)':dir==='out'?'var(--color-primary)':dir==='error'?'var(--color-error)':'var(--color-secondary)'};'>${msg}</span>`;
              log.appendChild(entry);
              log.scrollTop = log.scrollHeight;
              if (recording && (dir === 'in' || dir === 'out')) {
                trafficLog.push({timestamp: new Date().toISOString(), direction: dir, payload: msg});
              }
            }
          }
          // Varsayılan bir client paneli ekle
          addClientPanel();
          // Tab switching logic
          const tabExample = document.getElementById(`tab-example-${idx}`);
          const tabTest = document.getElementById(`tab-test-${idx}`);
          const examplePane = document.getElementById(`example-pane-${idx}`);
          const testPane = document.getElementById(`test-pane-${idx}`);
          tabExample.onclick = () => {
            tabExample.classList.add('active');
            tabTest.classList.remove('active');
            examplePane.style.display = 'block';
            testPane.style.display = 'none';
          };
          tabTest.onclick = () => {
            tabTest.classList.add('active');
            tabExample.classList.remove('active');
            examplePane.style.display = 'none';
            testPane.style.display = 'block';
          };
        });
      });
  </script>
</body>
</html> 